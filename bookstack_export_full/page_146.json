{
  "id": 146,
  "title": "Existing Webhook Implementation",
  "slug": "existing-webhook-implementation",
  "url": "https://knowledge.oculair.ca/page/146",
  "updated_at": "2025-09-08T16:15:17.000000Z",
  "body_html": "<h1 id=\"bkmrk-existing-webhook-imp\">Existing Webhook Implementation</h1>\n<h2 id=\"bkmrk-overview\">Overview</h2>\n<p id=\"bkmrk-huly-currently-has-a\">Huly currently has a <strong>standalone webhook service</strong> (<code>huly-webhook</code>) that operates as a separate microservice outside the main Huly codebase. This service provides webhook functionality by monitoring MongoDB changes and delivering HTTP notifications to configured endpoints.</p>\n<h2 id=\"bkmrk-architecture\">Architecture</h2>\n<h3 id=\"bkmrk-location-and-structu\">Location and Structure</h3>\n<ul id=\"bkmrk-location%3A-huly-webho\">\n<li><strong>Location</strong>: <code>huly-webhook/</code> directory (separate from main Huly codebase)</li>\n<li><strong>Technology</strong>: Node.js/Express.js standalone service</li>\n<li><strong>Database Monitoring</strong>: MongoDB Change Streams</li>\n<li><strong>Event Detection</strong>: Monitors MongoDB collections directly</li>\n<li><strong>Delivery</strong>: HTTP POST requests with retry logic and dead letter queue</li>\n</ul>\n<h3 id=\"bkmrk-key-components\">Key Components</h3>\n<pre id=\"bkmrk-huly-webhook%2F-%E2%94%9C%E2%94%80%E2%94%80-sr\"><code>huly-webhook/\n├── src/\n│   ├── adapters/           # Database adapters\n│   ├── config/            # Configuration management\n│   ├── controllers/       # HTTP request handlers\n│   ├── middleware/        # Authentication &amp; validation\n│   ├── models/           # Data models\n│   ├── routes/           # API route definitions\n│   ├── services/         # Business logic services\n│   └── utils/            # Utility functions\n├── tests/                # Test suites\n├── docker-compose.yml    # Docker configuration\n└── README.md            # Documentation\n</code></pre>\n<h2 id=\"bkmrk-supported-events\">Supported Events</h2>\n<p id=\"bkmrk-the-standalone-servi\">The standalone service currently supports the following webhook events:</p>\n<h3 id=\"bkmrk-issue-events\">Issue Events</h3>\n<ul id=\"bkmrk-issue.created---new-\">\n<li><code>issue.created</code> - New issue created</li>\n<li><code>issue.updated</code> - Issue modified</li>\n<li><code>issue.deleted</code> - Issue removed</li>\n<li><code>issue.status_changed</code> - Issue status changed</li>\n<li><code>issue.assigned</code> - Issue assignment changed</li>\n</ul>\n<h3 id=\"bkmrk-project-events\">Project Events</h3>\n<ul id=\"bkmrk-project.created---ne\">\n<li><code>project.created</code> - New project created</li>\n<li><code>project.updated</code> - Project settings modified</li>\n<li><code>project.archived</code> - Project archived</li>\n</ul>\n<h3 id=\"bkmrk-comment-and-attachme\">Comment and Attachment Events</h3>\n<ul id=\"bkmrk-comment.created---co\">\n<li><code>comment.created</code> - Comment added to issue</li>\n<li><code>attachment.added</code> - File attached to issue</li>\n</ul>\n<h2 id=\"bkmrk-event-payload-struct\">Event Payload Structure</h2>\n<p id=\"bkmrk-the-standalone-servi-1\">The standalone service generates webhook payloads in this format:</p>\n<pre id=\"bkmrk-%7B-%22id%22%3A-%22unique-even\"><code class=\"language-json\">{\n  \"id\": \"unique-event-id\",\n  \"type\": \"issue.created\",\n  \"timestamp\": \"2025-07-17T20:45:00Z\",\n  \"workspace\": \"agentspace\",\n  \"data\": {\n    \"issue\": {\n      \"id\": \"LMP-123\",\n      \"identifier\": \"LMP-123\",\n      \"title\": \"Issue title\",\n      \"description\": \"Issue description\",\n      \"status\": \"Backlog\",\n      \"priority\": \"medium\",\n      \"assignee\": null,\n      \"project\": {\n        \"id\": \"project-id\",\n        \"identifier\": \"LMP\",\n        \"name\": \"Project Name\"\n      },\n      \"createdBy\": \"user@example.com\",\n      \"createdAt\": \"2025-07-17T20:45:00Z\",\n      \"updatedAt\": \"2025-07-17T20:45:00Z\"\n    }\n  },\n  \"changes\": {\n    \"status\": {\n      \"from\": \"Backlog\",\n      \"to\": \"In Progress\"\n    }\n  }\n}\n</code></pre>\n<h2 id=\"bkmrk-key-features\">Key Features</h2>\n<h3 id=\"bkmrk-security-features\">Security Features</h3>\n<ul id=\"bkmrk-hmac-sha256-signatur\">\n<li><strong>HMAC-SHA256 signature verification</strong> using configurable secrets</li>\n<li><strong>API key authentication</strong> for webhook management endpoints</li>\n<li><strong>IP whitelisting support</strong> for additional security</li>\n<li><strong>SSL/TLS requirement</strong> for webhook URLs</li>\n</ul>\n<h3 id=\"bkmrk-reliability-features\">Reliability Features</h3>\n<ul id=\"bkmrk-configurable-retry-m\">\n<li><strong>Configurable retry mechanisms</strong> with exponential backoff</li>\n<li><strong>Dead letter queue</strong> for failed deliveries</li>\n<li><strong>Circuit breaker pattern</strong> for failing endpoints</li>\n<li><strong>Delivery status tracking</strong> and logging</li>\n</ul>\n<h3 id=\"bkmrk-filtering-and-config\">Filtering and Configuration</h3>\n<ul id=\"bkmrk-event-filtering-by-p\">\n<li><strong>Event filtering</strong> by project, status, priority, assignee</li>\n<li><strong>Custom headers</strong> support for webhook requests</li>\n<li><strong>Configurable timeout values</strong> (default: 30 seconds)</li>\n<li><strong>Rate limiting</strong> to prevent abuse</li>\n</ul>\n<h3 id=\"bkmrk-monitoring-and-obser\">Monitoring and Observability</h3>\n<ul id=\"bkmrk-comprehensive-loggin\">\n<li><strong>Comprehensive logging</strong> with structured format</li>\n<li><strong>Health checks</strong> and statistics endpoints</li>\n<li><strong>Delivery metrics</strong> and failure tracking</li>\n<li><strong>Real-time monitoring</strong> of webhook status</li>\n</ul>\n<h2 id=\"bkmrk-api-endpoints\">API Endpoints</h2>\n<p id=\"bkmrk-the-standalone-servi-2\">The standalone service provides these management endpoints:</p>\n<h3 id=\"bkmrk-webhook-management\">Webhook Management</h3>\n<ul id=\"bkmrk-post-%2Fapi%2Fwebhooks--\">\n<li><code>POST /api/webhooks</code> - Create webhook</li>\n<li><code>GET /api/webhooks</code> - List webhooks</li>\n<li><code>PUT /api/webhooks/:id</code> - Update webhook</li>\n<li><code>DELETE /api/webhooks/:id</code> - Delete webhook</li>\n</ul>\n<h3 id=\"bkmrk-testing-and-monitori\">Testing and Monitoring</h3>\n<ul id=\"bkmrk-post-%2Fapi%2Fwebhooks%2F%3A\">\n<li><code>POST /api/webhooks/:id/test</code> - Test webhook delivery</li>\n<li><code>GET /api/webhooks/:id/deliveries</code> - Get delivery history</li>\n<li><code>POST /api/webhooks/:id/replay/:deliveryId</code> - Replay failed delivery</li>\n<li><code>GET /api/health</code> - Service health check</li>\n<li><code>GET /api/stats</code> - Webhook statistics</li>\n</ul>\n<h2 id=\"bkmrk-configuration\">Configuration</h2>\n<h3 id=\"bkmrk-environment-variable\">Environment Variables</h3>\n<p id=\"bkmrk-the-service-uses-the\">The service uses these key configuration options:</p>\n<pre id=\"bkmrk-%23-service-configurat\"><code class=\"language-bash\"># Service Configuration\nPORT=3456\nMONGODB_URL=mongodb://localhost:27017/huly\nWEBHOOK_SECRET_KEY=your-webhook-secret-key\nAPI_KEY=your-api-key\n\n# Retry Configuration\nRETRY_MAX_ATTEMPTS=3\nRETRY_BACKOFF_MULTIPLIER=2\n\n# Security Configuration\nWEBHOOK_ALLOWED_IPS=192.168.1.0/24,10.0.0.0/8\n\n# Performance Configuration\nWEBHOOK_TIMEOUT=30000\nWEBHOOK_RATE_LIMIT=100\nLOG_LEVEL=info\n</code></pre>\n<h2 id=\"bkmrk-deployment\">Deployment</h2>\n<h3 id=\"bkmrk-docker-integration\">Docker Integration</h3>\n<p id=\"bkmrk-the-service-can-be-d\">The service can be deployed alongside Huly using Docker Compose:</p>\n<pre id=\"bkmrk-services%3A-huly-webho\"><code class=\"language-yaml\">services:\n  huly-webhook:\n    image: huly-webhook-service:latest\n    restart: unless-stopped\n    ports:\n      - \"3456:3456\"\n    environment:\n      - MONGODB_URL=mongodb://mongodb:27017/huly\n      - WEBHOOK_SECRET_KEY=${WEBHOOK_SECRET_KEY}\n      - API_KEY=${WEBHOOK_API_KEY}\n    networks:\n      - huly-network\n    depends_on:\n      - mongodb\n</code></pre>\n<h3 id=\"bkmrk-nginx-configuration\">Nginx Configuration</h3>\n<p id=\"bkmrk-integration-with-hul\">Integration with Huly's reverse proxy:</p>\n<pre id=\"bkmrk-location-%2Fwebhook%2F-%7B\"><code class=\"language-nginx\">location /webhook/ {\n    proxy_pass http://huly-webhook:3456/;\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header X-Forwarded-Proto $scheme;\n}\n</code></pre>\n<h2 id=\"bkmrk-strengths-and-limita\">Strengths and Limitations</h2>\n<h3 id=\"bkmrk-strengths\">Strengths</h3>\n<p id=\"bkmrk-%E2%9C%85-fully-functional--\">✅ <strong>Fully functional</strong> - Complete webhook implementation\n✅ <strong>Independent deployment</strong> - No impact on Huly core\n✅ <strong>Comprehensive features</strong> - Security, retry logic, monitoring\n✅ <strong>Production ready</strong> - Used in real deployments\n✅ <strong>Well documented</strong> - Clear API and configuration docs</p>\n<h3 id=\"bkmrk-limitations\">Limitations</h3>\n<p id=\"bkmrk-%E2%9D%8C-separate-infrastru\">❌ <strong>Separate infrastructure</strong> - Requires additional deployment\n❌ <strong>MongoDB dependency</strong> - Requires Change Streams (replica set)\n❌ <strong>Limited integration</strong> - No access to Huly's internal APIs\n❌ <strong>Data consistency</strong> - Potential lag from Change Streams\n❌ <strong>Maintenance overhead</strong> - Separate codebase to maintain</p>\n<h2 id=\"bkmrk-integration-with-hul-1\">Integration with Huly</h2>\n<p id=\"bkmrk-the-standalone-servi-3\">The standalone service integrates with Huly through:</p>\n<ol id=\"bkmrk-mongodb-monitoring--\">\n<li><strong>MongoDB monitoring</strong> - Watches the same database as Huly</li>\n<li><strong>Collection mapping</strong> - Maps MongoDB collections to Huly document types</li>\n<li><strong>Event transformation</strong> - Converts database changes to webhook events</li>\n<li><strong>External API</strong> - Provides webhook management through REST API</li>\n</ol>\n<p id=\"bkmrk-this-approach-works-\">This approach works well but has limitations in terms of accessing Huly's internal business logic and maintaining data consistency.</p>\n<h2 id=\"bkmrk-next-steps\">Next Steps</h2>\n<p id=\"bkmrk-understanding-this-e\">Understanding this existing implementation provides the foundation for:</p>\n<ul id=\"bkmrk-evaluating-integrati\">\n<li>Evaluating integration opportunities</li>\n<li>Planning migration strategies</li>\n<li>Leveraging existing patterns and features</li>\n<li>Making informed decisions about future development</li>\n</ul>\n<p id=\"bkmrk-continue-to-huly-cor\">Continue to <a href=\"./huly-core-architecture\">Huly Core Architecture</a> to understand how webhooks could be integrated natively into Huly's system.</p>\n",
  "tags": [],
  "book": null,
  "chapter": null
}