{
  "id": 118,
  "title": "Troubleshooting Guide",
  "slug": "troubleshooting-guide",
  "url": "https://knowledge.oculair.ca/books/unknown/page/troubleshooting-guide",
  "updated_at": "2025-05-06T16:27:58.000000Z",
  "body_html": "<h1 id=\"bkmrk-troubleshooting-guid\">Troubleshooting Guide</h1>\n<h2 id=\"bkmrk-common-issues-and-so\">Common Issues and Solutions</h2>\n<p id=\"bkmrk-this-guide-covers-co\">This guide covers common issues you might encounter when working with the BookStack-Graphiti integration and provides step-by-step solutions to resolve them.</p>\n<h2 id=\"bkmrk-webhook-receiver-iss\">Webhook Receiver Issues</h2>\n<h3 id=\"bkmrk-webhook-receiver-not\">Webhook Receiver Not Starting</h3>\n<p id=\"bkmrk-symptoms%3A\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-error-messages-when-\">\n<li>Error messages when trying to start the webhook receiver</li>\n<li>Unable to access the health check endpoint</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-port-conflict-missin\">\n<li>Port conflict</li>\n<li>Missing dependencies</li>\n<li>Invalid configuration</li>\n</ol>\n<p id=\"bkmrk-solutions%3A\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-check-for-port-confl\">\n<li>\n<p><strong>Check for port conflicts:</strong></p>\n<pre><code class=\"language-bash\"># Check if port 8003 is already in use\nnetstat -tuln | grep 8003\n</code></pre>\n<p>If the port is in use, either stop the conflicting service or change the port in the <code>.env</code> file.</p>\n</li>\n<li>\n<p><strong>Verify dependencies:</strong></p>\n<pre><code class=\"language-bash\">pip install -r requirements.txt\n</code></pre>\n</li>\n<li>\n<p><strong>Validate configuration:</strong></p>\n<ul>\n<li>Ensure all required environment variables are set in the <code>.env</code> file</li>\n<li>Check for syntax errors in the configuration files</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-webhook-receiver-cra\">Webhook Receiver Crashes</h3>\n<p id=\"bkmrk-symptoms%3A-1\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-the-webhook-receiver\">\n<li>The webhook receiver starts but crashes after receiving events</li>\n<li>Error messages in the logs</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-1\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-invalid-webhook-payl\">\n<li>Invalid webhook payload</li>\n<li>Connection issues with Graphiti</li>\n<li>Memory or resource constraints</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-1\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-check-the-logs-for-e\">\n<li>\n<p><strong>Check the logs for error messages:</strong></p>\n<pre><code class=\"language-bash\">docker-compose logs -f\n</code></pre>\n</li>\n<li>\n<p><strong>Verify Graphiti connection:</strong></p>\n<ul>\n<li>Ensure the Graphiti endpoint is correct in the <code>.env</code> file</li>\n<li>Check that the Graphiti service is running and accessible</li>\n</ul>\n</li>\n<li>\n<p><strong>Monitor resource usage:</strong></p>\n<pre><code class=\"language-bash\">docker stats\n</code></pre>\n<p>If memory usage is high, consider increasing the container's memory limit.</p>\n</li>\n</ol>\n<h2 id=\"bkmrk-bookstack-api-issues\">BookStack API Issues</h2>\n<h3 id=\"bkmrk-authentication-failu\">Authentication Failures</h3>\n<p id=\"bkmrk-symptoms%3A-2\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-error-messages-about\">\n<li>Error messages about invalid credentials</li>\n<li>Unable to fetch data from BookStack</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-2\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-incorrect-api-token-\">\n<li>Incorrect API token</li>\n<li>Expired token</li>\n<li>Insufficient permissions</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-2\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-verify-api-credentia\">\n<li>\n<p><strong>Verify API credentials:</strong></p>\n<ul>\n<li>Check that <code>BS_TOKEN_ID</code> and <code>BS_TOKEN_SECRET</code> are correct in the <code>.env</code> file</li>\n<li>Regenerate the token in BookStack if necessary</li>\n</ul>\n</li>\n<li>\n<p><strong>Check token permissions:</strong></p>\n<ul>\n<li>Ensure the token has read access to all entity types</li>\n<li>Create a new token with appropriate permissions if needed</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-rate-limiting\">Rate Limiting</h3>\n<p id=\"bkmrk-symptoms%3A-3\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-synchronization-slow\">\n<li>Synchronization slows down or fails</li>\n<li>Error messages about too many requests</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-3\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-too-many-api-request\">\n<li>Too many API requests in a short time</li>\n<li>BookStack rate limiting configuration</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-3\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-implement-request-th\">\n<li>\n<p><strong>Implement request throttling:</strong></p>\n<ul>\n<li>Modify the synchronization script to add delays between requests</li>\n<li>Reduce the batch size for API requests</li>\n</ul>\n</li>\n<li>\n<p><strong>Optimize synchronization:</strong></p>\n<ul>\n<li>Use the cache to avoid unnecessary requests</li>\n<li>Synchronize during off-peak hours</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"bkmrk-webhook-configuratio\">Webhook Configuration Issues</h2>\n<h3 id=\"bkmrk-webhooks-not-trigger\">Webhooks Not Triggering</h3>\n<p id=\"bkmrk-symptoms%3A-4\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-changes-in-bookstack\">\n<li>Changes in BookStack are not reflected in Graphiti</li>\n<li>No incoming webhook events in the logs</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-4\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-webhook-not-configur\">\n<li>Webhook not configured in BookStack</li>\n<li>Incorrect webhook URL</li>\n<li>Webhook disabled or inactive</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-4\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-verify-webhook-confi\">\n<li>\n<p><strong>Verify webhook configuration in BookStack:</strong></p>\n<ul>\n<li>Go to <strong>Settings</strong> &gt; <strong>Webhooks</strong> in BookStack</li>\n<li>Ensure the webhook is active and the URL is correct</li>\n<li>Check that the appropriate events are selected</li>\n</ul>\n</li>\n<li>\n<p><strong>Test the webhook:</strong></p>\n<ul>\n<li>Use the test script to send sample webhook payloads</li>\n</ul>\n<pre><code class=\"language-bash\">python test_bookstack_webhook.py\n</code></pre>\n</li>\n<li>\n<p><strong>Check network connectivity:</strong></p>\n<ul>\n<li>Ensure BookStack can reach the webhook receiver</li>\n<li>Check for any firewalls or network restrictions</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-webhook-payload-proc\">Webhook Payload Processing Errors</h3>\n<p id=\"bkmrk-symptoms%3A-5\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-webhook-events-are-r\">\n<li>Webhook events are received but not processed correctly</li>\n<li>Error messages in the logs about invalid payloads</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-5\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-unexpected-payload-f\">\n<li>Unexpected payload format</li>\n<li>Missing required fields</li>\n<li>Error in the event processing logic</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-5\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-inspect-the-webhook-\">\n<li>\n<p><strong>Inspect the webhook payload:</strong></p>\n<ul>\n<li>Check the logs for the raw webhook payload</li>\n<li>Compare it with the expected format</li>\n</ul>\n</li>\n<li>\n<p><strong>Update the event processor:</strong></p>\n<ul>\n<li>Modify the event processor to handle the actual payload format</li>\n<li>Add more robust error handling and validation</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"bkmrk-data-synchronization\">Data Synchronization Issues</h2>\n<h3 id=\"bkmrk-initial-synchronizat\">Initial Synchronization Fails</h3>\n<p id=\"bkmrk-symptoms%3A-6\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-error-messages-durin\">\n<li>Error messages during initial synchronization</li>\n<li>Incomplete data in Graphiti</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-6\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-connection-issues-wi\">\n<li>Connection issues with BookStack or Graphiti</li>\n<li>Large amount of data causing timeouts</li>\n<li>Errors in the synchronization logic</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-6\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-check-connectivity%3A-\">\n<li>\n<p><strong>Check connectivity:</strong></p>\n<ul>\n<li>Verify that both BookStack and Graphiti are accessible</li>\n<li>Test the connections with simple API requests</li>\n</ul>\n</li>\n<li>\n<p><strong>Implement pagination and batching:</strong></p>\n<ul>\n<li>Ensure the synchronization script uses pagination</li>\n<li>Process data in smaller batches</li>\n</ul>\n</li>\n<li>\n<p><strong>Run with verbose logging:</strong></p>\n<pre><code class=\"language-bash\">python -m logging=DEBUG sync_bookstack_data.py\n</code></pre>\n</li>\n</ol>\n<h3 id=\"bkmrk-missing-or-incomplet\">Missing or Incomplete Data</h3>\n<p id=\"bkmrk-symptoms%3A-7\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-some-entities-are-mi\">\n<li>Some entities are missing from Graphiti</li>\n<li>Relationships between entities are incorrect</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-7\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-synchronization-erro\">\n<li>Synchronization errors</li>\n<li>Webhook events not processed correctly</li>\n<li>Cache issues</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-7\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-force-a-complete-res\">\n<li>\n<p><strong>Force a complete resynchronization:</strong></p>\n<ul>\n<li>Delete the cache file: <code>rm bookstack_sync_cache.json</code></li>\n<li>Restart the webhook receiver with <code>ENABLE_SYNC=true</code></li>\n</ul>\n</li>\n<li>\n<p><strong>Check for specific entity issues:</strong></p>\n<ul>\n<li>Use the BookStack API to fetch the entity directly</li>\n<li>Compare with the data in Graphiti</li>\n</ul>\n</li>\n<li>\n<p><strong>Verify relationship creation:</strong></p>\n<ul>\n<li>Check the logs for relationship creation messages</li>\n<li>Ensure the correct relationship types are being created</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"bkmrk-graphiti-integration\">Graphiti Integration Issues</h2>\n<h3 id=\"bkmrk-connection-failures\">Connection Failures</h3>\n<p id=\"bkmrk-symptoms%3A-8\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-error-messages-about-1\">\n<li>Error messages about unable to connect to Graphiti</li>\n<li>Failed to add episodes or create nodes</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-8\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-incorrect-graphiti-e\">\n<li>Incorrect Graphiti endpoint</li>\n<li>Graphiti service not running</li>\n<li>Network connectivity issues</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-8\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-verify-graphiti-conf\">\n<li>\n<p><strong>Verify Graphiti configuration:</strong></p>\n<ul>\n<li>Check that <code>GRAPHITI_ENDPOINT</code> is correct in the <code>.env</code> file</li>\n<li>Ensure the Neo4j connection parameters are correct</li>\n</ul>\n</li>\n<li>\n<p><strong>Test Graphiti connectivity:</strong></p>\n<pre><code class=\"language-bash\">curl -X GET \"${GRAPHITI_ENDPOINT}/health\"\n</code></pre>\n</li>\n<li>\n<p><strong>Check Graphiti logs:</strong></p>\n<ul>\n<li>Look for any error messages in the Graphiti service logs</li>\n<li>Verify that Graphiti is properly connected to Neo4j</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-data-model-inconsist\">Data Model Inconsistencies</h3>\n<p id=\"bkmrk-symptoms%3A-9\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-unexpected-node-or-r\">\n<li>Unexpected node or relationship types in Graphiti</li>\n<li>Missing properties on nodes or relationships</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-9\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-schema-changes-in-bo\">\n<li>Schema changes in BookStack</li>\n<li>Errors in the mapping logic</li>\n<li>Inconsistent data transformation</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-9\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-review-the-graph-sch\">\n<li>\n<p><strong>Review the graph schema:</strong></p>\n<ul>\n<li>Check <code>graph_schema.py</code> for the current schema definition</li>\n<li>Ensure it matches the expected BookStack entity structure</li>\n</ul>\n</li>\n<li>\n<p><strong>Inspect the data transformation:</strong></p>\n<ul>\n<li>Look for any discrepancies in how data is transformed</li>\n<li>Update the mapping logic if necessary</li>\n</ul>\n</li>\n<li>\n<p><strong>Clean and rebuild the graph:</strong></p>\n<ul>\n<li>Consider clearing the graph and performing a full resynchronization</li>\n<li>Document any schema changes for future reference</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"bkmrk-performance-issues\">Performance Issues</h2>\n<h3 id=\"bkmrk-slow-synchronization\">Slow Synchronization</h3>\n<p id=\"bkmrk-symptoms%3A-10\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-initial-synchronizat-1\">\n<li>Initial synchronization takes a long time</li>\n<li>High CPU or memory usage during synchronization</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-10\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-large-amount-of-data\">\n<li>Large amount of data</li>\n<li>Inefficient API requests</li>\n<li>Resource constraints</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-10\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-optimize-batch-size%3A\">\n<li>\n<p><strong>Optimize batch size:</strong></p>\n<ul>\n<li>Adjust the batch size for API requests</li>\n<li>Find a balance between too many small requests and too few large requests</li>\n</ul>\n</li>\n<li>\n<p><strong>Improve caching:</strong></p>\n<ul>\n<li>Ensure the cache is being used effectively</li>\n<li>Consider more efficient caching mechanisms</li>\n</ul>\n</li>\n<li>\n<p><strong>Allocate more resources:</strong></p>\n<ul>\n<li>Increase the container's CPU and memory limits</li>\n<li>Consider running on more powerful hardware</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-slow-webhook-process\">Slow Webhook Processing</h3>\n<p id=\"bkmrk-symptoms%3A-11\"><strong>Symptoms:</strong></p>\n<ul id=\"bkmrk-webhook-events-take-\">\n<li>Webhook events take a long time to process</li>\n<li>Backlog of events builds up</li>\n</ul>\n<p id=\"bkmrk-possible-causes%3A-11\"><strong>Possible Causes:</strong></p>\n<ol id=\"bkmrk-complex-event-proces\">\n<li>Complex event processing logic</li>\n<li>Slow Graphiti operations</li>\n<li>Resource constraints</li>\n</ol>\n<p id=\"bkmrk-solutions%3A-11\"><strong>Solutions:</strong></p>\n<ol id=\"bkmrk-optimize-event-proce\">\n<li>\n<p><strong>Optimize event processing:</strong></p>\n<ul>\n<li>Simplify the event processing logic where possible</li>\n<li>Batch related operations together</li>\n</ul>\n</li>\n<li>\n<p><strong>Improve Graphiti performance:</strong></p>\n<ul>\n<li>Optimize Neo4j queries and indexes</li>\n<li>Consider upgrading Neo4j hardware</li>\n</ul>\n</li>\n<li>\n<p><strong>Implement asynchronous processing:</strong></p>\n<ul>\n<li>Queue events for background processing</li>\n<li>Process events in parallel where possible</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"bkmrk-logging-and-debuggin\">Logging and Debugging</h2>\n<h3 id=\"bkmrk-enabling-debug-loggi\">Enabling Debug Logging</h3>\n<p id=\"bkmrk-to-get-more-detailed\">To get more detailed information for troubleshooting, enable debug logging:</p>\n<ol id=\"bkmrk-set-the-log-level-in\">\n<li>\n<p><strong>Set the log level in the <code>.env</code> file:</strong></p>\n<pre><code>LOG_LEVEL=DEBUG\n</code></pre>\n</li>\n<li>\n<p><strong>Restart the webhook receiver:</strong></p>\n<pre><code class=\"language-bash\">docker-compose down\ndocker-compose up -d\n</code></pre>\n</li>\n<li>\n<p><strong>View the detailed logs:</strong></p>\n<pre><code class=\"language-bash\">docker-compose logs -f\n</code></pre>\n</li>\n</ol>\n<h3 id=\"bkmrk-using-the-test-scrip\">Using the Test Script</h3>\n<p id=\"bkmrk-the-included-test-sc\">The included test script can be useful for troubleshooting:</p>\n<pre id=\"bkmrk-python-test_bookstac\"><code class=\"language-bash\">python test_bookstack_webhook.py\n</code></pre>\n<p id=\"bkmrk-this-script-sends-sa\">This script sends sample webhook payloads to the webhook receiver, which can help isolate issues with event processing.</p>\n<h3 id=\"bkmrk-inspecting-the-cache\">Inspecting the Cache</h3>\n<p id=\"bkmrk-the-cache-file-%28book\">The cache file (<code>bookstack_sync_cache.json</code>) contains information about which entities have been processed. Inspecting this file can help identify synchronization issues:</p>\n<pre id=\"bkmrk-cat-bookstack_sync_c\"><code class=\"language-bash\">cat bookstack_sync_cache.json\n</code></pre>\n<h2 id=\"bkmrk-maintenance-best-pra\">Maintenance Best Practices</h2>\n<h3 id=\"bkmrk-regular-monitoring\">Regular Monitoring</h3>\n<ol id=\"bkmrk-check-logs-regularly\">\n<li>\n<p><strong>Check logs regularly:</strong></p>\n<pre><code class=\"language-bash\">docker-compose logs --tail=100\n</code></pre>\n</li>\n<li>\n<p><strong>Monitor resource usage:</strong></p>\n<pre><code class=\"language-bash\">docker stats\n</code></pre>\n</li>\n<li>\n<p><strong>Verify webhook deliveries in BookStack:</strong></p>\n<ul>\n<li>Go to <strong>Settings</strong> &gt; <strong>Webhooks</strong> in BookStack</li>\n<li>Check the recent deliveries section</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-periodic-maintenance\">Periodic Maintenance</h3>\n<ol id=\"bkmrk-update-dependencies%3A\">\n<li>\n<p><strong>Update dependencies:</strong></p>\n<pre><code class=\"language-bash\">pip install -r requirements.txt --upgrade\n</code></pre>\n</li>\n<li>\n<p><strong>Rebuild the container:</strong></p>\n<pre><code class=\"language-bash\">docker-compose build --no-cache\ndocker-compose up -d\n</code></pre>\n</li>\n<li>\n<p><strong>Perform a full resynchronization periodically:</strong></p>\n<ul>\n<li>Delete the cache file</li>\n<li>Run a full synchronization</li>\n<li>This helps ensure data consistency</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"bkmrk-backup-and-recovery\">Backup and Recovery</h3>\n<ol id=\"bkmrk-back-up-the-cache-fi\">\n<li>\n<p><strong>Back up the cache file:</strong></p>\n<pre><code class=\"language-bash\">cp bookstack_sync_cache.json bookstack_sync_cache.backup.json\n</code></pre>\n</li>\n<li>\n<p><strong>Back up the Neo4j database:</strong></p>\n<ul>\n<li>Follow Neo4j backup procedures</li>\n<li>Store backups securely</li>\n</ul>\n</li>\n<li>\n<p><strong>Document recovery procedures:</strong></p>\n<ul>\n<li>Keep notes on how to restore from backups</li>\n<li>Test recovery procedures periodically</li>\n</ul>\n</li>\n</ol>\n<h2 id=\"bkmrk-getting-help\">Getting Help</h2>\n<p id=\"bkmrk-if-you-encounter-iss\">If you encounter issues that aren't covered in this guide:</p>\n<ol id=\"bkmrk-check-the-project-do\">\n<li>\n<p><strong>Check the project documentation:</strong></p>\n<ul>\n<li>Review the README.md and other documentation files</li>\n<li>Look for any known issues or limitations</li>\n</ul>\n</li>\n<li>\n<p><strong>Examine the source code:</strong></p>\n<ul>\n<li>Look at the relevant components to understand their behavior</li>\n<li>Check for any comments or TODOs that might explain issues</li>\n</ul>\n</li>\n<li>\n<p><strong>Reach out to the development team:</strong></p>\n<ul>\n<li>Provide detailed information about the issue</li>\n<li>Include logs, error messages, and steps to reproduce</li>\n</ul>\n</li>\n</ol>\n",
  "tags": [],
  "book": "Unknown",
  "chapter": ""
}